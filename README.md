What Is This?
=============
`PhpImage` is a php library that take care of the image workflow for you: 
resolve, compress, resize and keep track of resized images by providing a fluent
API that just work :)

Installation
============
`composer require elgoumri-oussama/php-image`

Get Started
===========
`PhpImage` uses [PhpConfig](https://github.com/OussamaElgoumri/php-config) so
basically all you have to do, is:

```php
use OussamaElgoumri\Components\Image;

// $img can be: url, local image, name of input field.
$image = new Image($img);
var_dump($image->get());

// or emit all the above and just use:
Image__get($img);
```

When you first instantiate `Image` it will go and do the following:
- `resolve()` get the image
- `validate()` make sure we have a valid image.
- `compress()` compress the image.
- `uuid()` generate unique identifier for the image.
- `copy()` copy the image to it's home.
- `resize()` resize the image.
- `compile()` compile all the information.

When you call `get()` you will get an iterrable instance of `ImageIterator`
containing images: your image + the ones generated by the resize. and each 
image is an instance of `ImageItem` that will allow you to do:
- `getHeight()`
- `getWidth()`
- `getSize()`
- `getMime()`
- `getType()` the result of `exif_imagetype()`
- `getSize()` the filesize of the image.
- `getPath()` the full path to the image.
- `getRelativePath()` the one you can use inside `<img src="<?= echo $item->getRelativePath(); ?>"`
- `toBase64()` convert image to base64 format.

Configuration
=============
Since we are using [PhpConfig](https://github.com/OussamaElgoumri/php-config)
this gives us a lot of flexibility of how we want to configure the images.

the default configuration:
```php
/**
 * @var $default_config     Default image configuration.
 */
protected $default_config = [
    'IMAGE_ALLOWED_TYPES',
    'IMAGE_DENIED_TYPES',
    'IMAGE_DIRS'     => 'Y/i/d',
    'IMAGE_PUBLIC'   => 'public/images',
    'IMAGE_RELATIVE' => 'images',
    'IMAGE_UUID'     => '%hash%--%time%.%ext%',
    'IMAGE_OPTIMIZE' => true,
    'IMAGE_SIZES'    => '1024x768,800x600,460x308,320x240,240x160,160,75',
];
```

### IMAGE_ALLOWED_TYPES & IMAGE_DENIED_TYPES
`IMAGE_ALLOWED_TYPES` and `IMAGE_DENIED_TYPES` uses the types defined by 
`exif_imagetype()` function, you can emit `IMAGETYPE_` or don't, you'r free :)

```php
try {
    // Accept only: jpg, png.  
    $image = new Image('my-image', [
        'IMAGE_ALLOWED_TYPES' => 'jpg,png,gif',
    ]);

    // OR:

    // Accept all except gif.
    $image = new Image('my-image', [
        'IMAGE_DENIED_TYPES' => 'gif',
    ]);
} catch (ImageException $e) {
    // all exceptions extend ImageException.
}
```

### IMAGE_DIRS
How do you want your directories to be created? accept anything accepted by the
`date()` function

if you use the default: `Y/i/d`, then the directory will look like this
```
- public
  - images
    - 2017
      - 03
        - 10
          your-image.png
```

### IMAGE_PUBLIC & IMAGE_RELATIVE
`IMAGE_PUBLIC` can be either full path to a location, or a path relative to the
base of your project.
`IMAGE_RELATIVE` the directory that contains all images.

The default configuration assumes you have this directory structure:

```
- src
- public
  - images
  - index.php
- vendor
```

### IMAGE_UUID
What will be the name of the image?
- `%hash%` image hash
- `%time%` current timestamp
- `%ext%` image extension

the default will generate an image that looks like this: `bb9ac6ff6127926d2931a041d96622d102cfdfa3--1489155431.jpeg`

### IMAGE_OPTIMIZE
Wether or not to optimize the image, default: true, required some linux libraries,
if they are not found, then it will just continue silently.

please check all the libraries you need [here](https://github.com/psliwa/image-optimizer)

### IMAGE_SIZES
The size that the image will be converted to, all the generated images follow
this pattern: `IMAGE_UUID--800x600.ext` example: `bb9ac6ff6127926d2931a041d96622d102cfdfa3--1489155431--120x120.jpeg`

Set Configuration
=================
You can:
- use the constructor, as we saw before
- use the command `vendor/bin/phpimage config:export` a new file `image.php` 
will be generated in the base of your project, inside `config` directory, 
update the configuration options there as you want.
- you can simply create a `.env` file in the base of your project, and set the
configuration options there.

please check [PhpConfig](https://github.com/OussamaElgoumri/php-config) for more
information.

Workflow
========
If you want to save the image in the database, then you can do as follow:
```php
// return a string containing your image and the ones generated by resize,
$data = Image__serialize('my-awesome-image');
```

If you want to do something with the images:
```php
// Return an array of `ImageItem` instance:
$data = Image__get('my-awesome-image');
```

If you store the results of `Image__serialize()` in the database, then you can
simply do:
```php
// return the same data as Image__get() function:
$data = Image__unserialize($serialized_images);
```

>
> **Note:**
> all functions follows this pattern `ClassName__method($arg)` so if you don't 
> wanna use it, then simply use: `(new ClassName)->method($arg)` but of course
> you'l have then to resolve the namespace of the class and all that headeach.!
>

ImageIterator usage:
====================
`Image::unserialize()` and `Image::get()` will return an iterrable instance of
`ImageIterator` that will allow you to:

```php
$it = Image__get('my-awesome-image');

foreach ($it as $imageItem) {
    echo $imageItem->size;
    echo $imageItem->width;
    echo $imageItem->height;
    echo $imageItem->mime;
    echo $imageItem->path;
    echo $imageItem->getRelativePath;
}
```

You can also search images by width and height, like this:
```php
$it = Image__get('my-awesome-image');
$imageItem = $it->whereWidth(800);
$imageItem = $it->whereHeight(600);
$imageItem = $it->whereWidthAndHeight(800, 600);
$imageItem = $it->whereWidhtAndHeight('800x600');

// If the width and height are equals, then simply do
$imageItem = $it->whereWidthAndHeight(800);
```
